<!-- templates/notifications/list.html -->
{% extends 'base.html' %}

{% block title %}Notifications - Barangay Concerns{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
        <div>
            <h1 class="fw-bold mb-1 d-flex align-items-center gap-2">
                <i data-lucide="bell" class="text-primary icon-lg"></i> Notifications
            </h1>
            <p class="text-secondary mb-0">
                {% if unread_count > 0 %}
                    You have <span class="fw-bold text-primary">{{ unread_count }}</span> unread notification{{ unread_count|pluralize }}
                {% else %}
                    All caught up! No new notifications.
                {% endif %}
            </p>
        </div>
        <div class="d-flex gap-2">
            {% if unread_count > 0 %}
            <form method="post" action="{% url 'notifications:mark_all_read' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary d-flex align-items-center gap-2 shadow-sm">
                    <i data-lucide="check-check" class="icon-sm"></i> Mark All Read
                </button>
            </form>
            {% endif %}
            
            {% if notifications %}
            <form method="post" action="{% url 'notifications:delete_all_read' %}" 
                  onsubmit="return confirm('Delete all read notifications?')">
                {% csrf_token %}
                <button type="submit" class="btn btn-light text-danger d-flex align-items-center gap-2">
                    <i data-lucide="trash-2" class="icon-sm"></i> Clear Read
                </button>
            </form>
            {% endif %}
        </div>
    </div>

    <div class="d-flex flex-column gap-3">
        {% for notification in notifications %}
        <div class="card border-0 shadow-sm {% if not notification.is_read %}border-start border-4 border-primary{% endif %}" 
             style="overflow: hidden; transition: transform 0.2s;">
            <div class="card-body p-3 d-flex gap-3">
                <div class="flex-shrink-0">
                    <div class="rounded-circle p-2 d-flex align-items-center justify-content-center"
                         style="width: 48px; height: 48px; background: {% if not notification.is_read %}var(--primary-light){% else %}#f1f5f9{% endif %}; color: {% if not notification.is_read %}var(--primary){% else %}var(--text-secondary){% endif %};">
                        
                        {% if notification.notification_type == 'STATUS_CHANGE' %}
                            <i data-lucide="refresh-cw" class="icon-md"></i>
                        {% elif notification.notification_type == 'PRIORITY_CHANGE' %}
                            <i data-lucide="zap" class="icon-md"></i>
                        {% elif notification.notification_type == 'RESOLVED' %}
                            <i data-lucide="check-circle" class="icon-md"></i>
                        {% elif notification.notification_type == 'ARCHIVED' %}
                            <i data-lucide="archive" class="icon-md"></i>
                        {% elif notification.notification_type == 'COMMENT' %}
                            <i data-lucide="message-circle" class="icon-md"></i>
                        {% else %}
                            <i data-lucide="bell" class="icon-md"></i>
                        {% endif %}
                    </div>
                </div>
                
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                        <h6 class="fw-bold mb-0 text-dark">{{ notification.title }}</h6>
                        <small class="text-secondary" style="font-size: 0.8rem;">
                            {{ notification.created_at|timesince }} ago
                        </small>
                    </div>
                    
                    <p class="text-secondary mb-2 small">{{ notification.message }}</p>
                    
                    {% if notification.concern %}
                    <div class="d-flex gap-2 mb-2">
                        <span class="badge bg-light text-dark border">
                            {{ notification.concern.get_category_display }}
                        </span>
                        <span class="badge badge-status-{{ notification.concern.status|lower }}">
                            {{ notification.concern.get_status_display }}
                        </span>
                    </div>
                    {% endif %}
                    
                    <div class="d-flex gap-2 mt-2">
                         {% if notification.concern %}
                            <a href="{% url 'concerns:detail' notification.concern.pk %}{% if not notification.is_read %}?mark_read={{ notification.pk }}{% endif %}" 
                               class="btn btn-sm btn-outline-primary py-1 px-3" style="font-size: 0.8rem;">
                                View Details
                            </a>
                        {% endif %}
                        
                        {% if not notification.is_read %}
                        <a href="{% url 'notifications:mark_read' notification.pk %}" 
                           class="btn btn-sm btn-light text-secondary py-1 px-3" style="font-size: 0.8rem;">
                           Mark Read
                        </a>
                        {% endif %}
                    </div>
                </div>
                
                <div class="flex-shrink-0 ms-2">
                    <form method="post" action="{% url 'notifications:delete' notification.pk %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link text-tertiary p-0" title="Delete" style="text-decoration: none;">
                            <i data-lucide="x" class="icon-sm"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-5">
            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                <i data-lucide="bell-off" class="text-secondary icon-xl"></i>
            </div>
            <h5 class="fw-bold text-secondary">No Notifications</h5>
            <p class="text-muted small">Notifications about your concerns will appear here.</p>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .card:hover {
        background-color: #f8fafc;
    }
</style>
{% endblock %}
